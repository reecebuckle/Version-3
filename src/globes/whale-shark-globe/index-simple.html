<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>Whale Shark Tracking - Simple View</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style type="text/css">
      html {
        height: 100%;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }
      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #001122 0%, #003366 100%);
        color: #ffffff;
        font-size: 14px;
        line-height: 1.4;
        height: 100%;
        overflow: hidden;
      }

      #container {
        width: 100%;
        height: 100%;
        position: relative;
      }

      .home-link {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 100;
        background: rgba(0, 0, 0, 0.8);
        padding: 10px 20px;
        border-radius: 20px;
        border: 1px solid #00ccff;
        backdrop-filter: blur(10px);
      }

      .home-link a {
        color: #00ccff;
        text-decoration: none;
        font-weight: bold;
        font-size: 14px;
      }

      .home-link a:hover {
        color: #ffffff;
      }

      #title {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(0, 20, 40, 0.9);
        border: 1px solid rgba(0, 150, 200, 0.3);
        border-radius: 8px;
        padding: 20px;
        backdrop-filter: blur(10px);
        max-width: 420px;
        width: 420px;
      }

      #simple-controls {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 20, 40, 0.9);
        border: 1px solid rgba(0, 150, 200, 0.3);
        border-radius: 8px;
        padding: 20px;
        backdrop-filter: blur(10px);
        text-align: center;
        min-width: 300px;
      }

      #info-panel {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(0, 20, 40, 0.9);
        border: 1px solid rgba(0, 150, 200, 0.3);
        border-radius: 8px;
        padding: 20px;
        backdrop-filter: blur(10px);
        max-width: 300px;
        width: 300px;
      }

      .button {
        background: linear-gradient(135deg, #0066cc, #00ccff);
        border: none;
        color: white;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin: 5px;
        transition: all 0.3s ease;
        font-weight: bold;
      }

      .button:hover {
        background: linear-gradient(135deg, #0088ff, #00ffff);
        box-shadow: 0 0 15px rgba(0, 204, 255, 0.4);
      }

      .button.active {
        background: linear-gradient(135deg, #ff6600, #ffaa00);
      }

      .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 1000;
      }

      .spinner {
        border: 3px solid rgba(0, 204, 255, 0.3);
        border-radius: 50%;
        border-top: 3px solid #00ccff;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .highlight {
        color: #00ccff;
        font-weight: bold;
      }

      .fact-box {
        background: rgba(0, 100, 150, 0.2);
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        border-left: 4px solid #00ccff;
      }

      .fact-title {
        color: #00ccff;
        font-weight: bold;
        margin-bottom: 8px;
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
        #title, #info-panel {
          position: relative;
          top: 10px;
          left: 10px;
          right: 10px;
          width: auto;
          max-width: none;
          margin-bottom: 10px;
        }

        #simple-controls {
          position: relative;
          bottom: auto;
          left: 10px;
          right: 10px;
          transform: none;
          min-width: auto;
          margin: 10px;
        }

        body {
          overflow-y: auto;
        }

        #container {
          height: 50vh;
          min-height: 300px;
        }
      }
    </style>
  </head>
  <body>

  <div id="container"></div>

  <div class="home-link">
    <a href="../../../index.html">üè† Back to Home</a>
  </div>

  <div id="loading" class="loading">
    <div class="spinner"></div>
    <div>Loading Whale Shark Data...</div>
  </div>

  <div id="title">
    <h2 style="margin: 0; color: #00ccff;">ü¶à Whale Shark Migration</h2>
    <div style="font-size: 14px; color: #cccccc; margin-top: 10px; line-height: 1.5;">
      This visualisation shows GPS tracking data for <strong>41 whale sharks</strong> in the Gulf of Mexico (2009-2015). 
      Each coloured line shows one shark's journey. These gentle giants can travel thousands of kilometres 
      following food sources and seasonal patterns.
      
      <div class="fact-box">
        <div class="fact-title">üìä Whale Shark Tracking Statistics</div>
        <div id="movement-stats" style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px;">
          <div>Total Sharks: <span class="highlight" id="total-sharks">41</span></div>
          <div>Total Distance: <span class="highlight">98,447 km</span></div>
          <div>Tracking Points: <span class="highlight" id="total-points">Loading...</span></div>
          <div>Average per Shark: <span class="highlight">2,401 km</span></div>
          <div>Study Period: <span class="highlight">2009-2015</span></div>
          <div>Average Speed: <span class="highlight">23.7 km/day</span></div>
          <div>Region: <span class="highlight">Gulf of Mexico</span></div>
          <div>Longest Journey: <span class="highlight">11,057 km</span></div>
        </div>
      </div>
      
      <div class="fact-box">
        <div class="fact-title">üåä Study Region & Data</div>
        <strong>Gulf of Mexico Focus:</strong> 22¬∞N - 30¬∞N, 98¬∞W - 82¬∞W<br>
        <strong>ü¶à Whale Shark Data Source:</strong> <a href="https://www.movebank.org/cms/webapp?gwt_fragment=page%3Dstudies%2Cpath%3Dstudy1153270750" target="_blank" style="color: #00ccff; text-decoration: none;">Movebank GPS Tracking</a><br>
        <strong>üåä Chlorophyll PACE Data Source:</strong> <a href="https://pace.oceansciences.org/access_pace_data.htm#!" target="_blank" style="color: #00ccff; text-decoration: none;">NASA PACE Ocean Color Data Portal</a>
      </div>
      
      <div class="fact-box">
        <div class="fact-title">üåü Did You Know?</div>
        Whale sharks are the world's largest fish, growing up to 12 metres long! 
        Despite their size, they eat tiny plankton and small fish.
      </div>
    </div>
  </div>

  <div id="info-panel">
    <div style="font-weight: bold; margin-bottom: 15px; color: #00ccff; font-size: 16px;">
      üó∫Ô∏è Legend
    </div>
    
    <div class="fact-box">
      <div class="fact-title">üé® Colour Coding</div>
      Each whale shark has a unique colour for its tracking path. Lines show movement over time, with markers indicating current positions.
    </div>
    
    <div class="fact-box">
      <div class="fact-title">ü¶à Symbols</div>
      <div style="display: flex; align-items: center; margin: 10px 0; font-size: 14px;">
        <div style="width: 12px; height: 12px; background: #00ccff; border-radius: 50%; margin-right: 10px;"></div>
        Start tracking position
      </div>
      <div style="display: flex; align-items: center; margin: 10px 0; font-size: 14px;">
        <div style="width: 24px; height: 2px; background: #00ccff; margin-right: 10px;"></div>
        Movement path
      </div>
      <div style="display: flex; align-items: center; margin: 10px 0; font-size: 14px;">
        <img src="./src/assets/shark-v3.jpg" style="width: 20px; height: 20px; margin-right: 10px;" alt="Whale Shark"
             onerror="this.onerror=null; this.src='../../assets/shark-v3.jpg'">
        End tracking position
      </div>
    </div>
    
    <div class="fact-box">
      <div class="fact-title">üéÆ Controls</div>
      ‚Ä¢ Drag to rotate the globe<br>
      ‚Ä¢ Scroll to zoom in/out<br>
      ‚Ä¢ Use buttons to filter sharks
    </div>
  </div>

  <div id="simple-controls">
    <div style="font-size: 18px; font-weight: bold; color: #00ccff; margin-bottom: 15px;">
      üéÆ Simple Controls
    </div>
    
    <div style="margin-bottom: 20px;">
      <button id="show-all" class="button active" onclick="showAllSharks()">Show All Sharks</button>
      <button id="show-few" class="button" onclick="showFewSharks()">Show 5 Sharks</button>
      <button id="show-one" class="button" onclick="showOneSharks()">Show 1 Shark</button>
    </div>
    
    <div style="margin-bottom: 15px; color: #cccccc;">
      <strong>üñ±Ô∏è Mouse Controls:</strong> Drag to rotate ‚Ä¢ Scroll to zoom
    </div>
    
    <div style="font-size: 12px; color: #888;">
      <strong>Current View:</strong> <span id="current-view">All 41 whale sharks</span>
    </div>
  </div>

  <script type="text/javascript" src="../../assets/globe/third-party/Detector.js"></script>
  <script type="text/javascript" src="../../assets/globe/third-party/three.min.js"></script>
  <script type="text/javascript" src="../../assets/globe/third-party/Tween.js"></script>
  <script type="text/javascript" src="whale-shark-globe.js"></script>
  <script type="text/javascript">

    // Global variables
    let globe;
    let sharkData = null;
    let currentMode = 'all';

    // Initialize the application
    if(!Detector.webgl){
      Detector.addGetWebGLMessage();
    } else {
      initializeSimpleWhaleSharkGlobe();
    }

    function initializeSimpleWhaleSharkGlobe() {
      const container = document.getElementById('container');
      
      console.log('ü¶à Initializing Simple Whale Shark Globe...');
      
      try {
        // Create whale shark globe
        globe = new DAT.WhaleSharkGlobe(container, {
          imgDir: '../../assets/globe/'
        });

        console.log('‚úÖ Globe initialized successfully');
        
        // Load whale shark data
        loadWhaleSharkData();
        
        // Start animation loop
        globe.animate();
        
      } catch (error) {
        console.error('‚ùå Error initializing globe:', error);
        showError('Failed to initialize 3D globe');
      }
    }

    function loadWhaleSharkData() {
      console.log('üì° Loading whale shark data...');
      
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '../../../whale-shark-json-files/whale-shark-json/whale_sharks_complete.json?v=' + Date.now(), true);
      
      xhr.onreadystatechange = function(e) {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            try {
              sharkData = JSON.parse(xhr.responseText);
              
              console.log(`‚úÖ Loaded data for ${sharkData.sharks.length} sharks`);
              
              // Load shark data into globe
              globe.loadSharkData(sharkData);
              
              // Hide loading screen
              document.getElementById('loading').style.display = 'none';
              
              // Update movement statistics
              updateMovementStats();
              
            } catch (error) {
              console.error('‚ùå Error parsing whale shark data:', error);
              showError('Failed to parse whale shark data');
            }
          } else {
            console.error('‚ùå Failed to load whale shark data');
            showError('Failed to load whale shark data');
          }
        }
      };
      xhr.send(null);
    }

    // Simple control functions
    function showAllSharks() {
      if (!sharkData) return;
      
      setActiveButton('show-all');
      currentMode = 'all';
      
      // Show all sharks
      sharkData.sharks.forEach(shark => {
        globe.toggleShark(shark.id, true);
      });
      
      document.getElementById('current-view').textContent = `All ${sharkData.sharks.length} whale sharks`;
      updateMovementStats();
      console.log('üëÅÔ∏è Showing all sharks');
    }

    function showFewSharks() {
      if (!sharkData) return;
      
      setActiveButton('show-few');
      currentMode = 'few';
      
      // Show only first 5 sharks
      sharkData.sharks.forEach((shark, index) => {
        globe.toggleShark(shark.id, index < 5);
      });
      
      document.getElementById('current-view').textContent = '5 selected whale sharks';
      updateMovementStats();
      console.log('üëÅÔ∏è Showing 5 sharks');
    }

    function showOneSharks() {
      if (!sharkData) return;
      
      setActiveButton('show-one');
      currentMode = 'one';
      
      // Show only the first shark (usually has most data)
      sharkData.sharks.forEach((shark, index) => {
        globe.toggleShark(shark.id, index === 0);
      });
      
      const firstShark = sharkData.sharks[0];
      document.getElementById('current-view').textContent = `${firstShark.name} (${firstShark.tracks.length} tracking points)`;
      updateMovementStats();
      console.log('üëÅÔ∏è Showing one shark');
    }

    function setActiveButton(activeId) {
      // Remove active class from all buttons
      document.querySelectorAll('.button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Add active class to selected button
      document.getElementById(activeId).classList.add('active');
    }

    function updateMovementStats() {
      if (!sharkData) return;
      
      const stats = globe.getSharkStats();
      
      document.getElementById('total-sharks').textContent = stats.totalSharks;
      document.getElementById('total-points').textContent = stats.totalTracks.toLocaleString();
    }

    function showError(message) {
      const loading = document.getElementById('loading');
      loading.innerHTML = `
        <div style="color: #ff6666;">
          <div>‚ùå Error</div>
          <div style="font-size: 12px; margin-top: 10px;">${message}</div>
          <div style="margin-top: 15px;">
            <button class="button" onclick="location.reload()" style="background: #ff6666;">
              üîÑ Reload Page
            </button>
          </div>
        </div>
      `;
      loading.style.display = 'block';
    }

  </script>

  </body>
</html>